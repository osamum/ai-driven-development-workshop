# Function Calling サンプル実装

## 概要

この実装サンプルは、Azure OpenAI の Function Calling 機能を使用して現在時刻を取得する機能の動作例を示します。

## 使用例

### 1. 基本的な時刻取得

**ユーザー入力**: "今の時刻を教えて"

**システム処理**:
1. OpenAI API に問い合わせ
2. `get_current_time` 関数の呼び出しが必要と判断
3. 関数を実行して現在時刻を取得
4. 結果を元に自然な回答を生成

**AI 回答例**: "現在の時刻は 2025年6月24日 16:31:12 です。日本標準時（JST）での時刻をお知らせしました。"

### 2. 工場設備管理文脈での時刻活用

**ユーザー入力**: "現在の時刻を基に、次回の設備点検スケジュールを教えて"

**AI 回答例**: "現在は 2025年6月24日 16:31:12 です。工場設備の定期点検スケジュールを確認いたします。

次回の設備点検予定：
- エア・コンプレッサー（設備ID: 001）: 明日 9:00-11:00
- 工作機械 CNC-A（設備ID: 002）: 明後日 14:00-16:00

現在時刻を基に、適切な点検準備を進めていただけます。"

### 3. シフト管理での活用

**ユーザー入力**: "現在のシフト状況を教えて"

**AI 回答例**: "現在の時刻は 16:31 です。

現在は日勤シフト時間帯（8:00-17:00）です。
- 現在のシフト: 日勤
- 次回シフト: 夜勤（21:00-6:00）
- 次回シフトまで: あと 4時間29分

シフト切り替え時の設備状況や引き継ぎ事項がございましたら、お知らせください。"

## 技術的な実装詳細

### Function Schema の定義

```json
{
  "type": "function",
  "function": {
    "name": "get_current_time",
    "description": "現在の日時を取得します。ユーザーが時刻や日付を知りたい場合に使用してください。",
    "parameters": {
      "type": "object",
      "properties": {},
      "required": []
    }
  }
}
```

### 関数の実行結果例

```json
{
  "current_time": "2025-06-24T07:31:12.009Z",
  "formatted_time": "2025/06/24 16:31:12",
  "timestamp": 1750750272009
}
```

### OpenAI API レスポンス例

#### 初回レスポンス（Function Call）
```json
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": null,
        "tool_calls": [
          {
            "id": "call_abc123",
            "type": "function",
            "function": {
              "name": "get_current_time",
              "arguments": "{}"
            }
          }
        ]
      }
    }
  ]
}
```

#### 最終レスポンス（自然言語回答）
```json
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "現在の時刻は2025年6月24日 16:31:12です。日本標準時（JST）での時刻をお知らせしました。"
      }
    }
  ]
}
```

## フロントエンド統合例

Vue.js のAIチャットコンポーネントで、Function Calling の結果を表示する際の考慮点：

### 1. ローディング状態の表示

Function Calling は通常のチャットよりも処理時間が長くなる場合があるため、適切なローディング表示を行います。

### 2. エラーハンドリング

関数実行エラーやネットワークエラーに対する適切なフォールバック表示を実装します。

### 3. ユーザビリティの向上

時刻情報を視覚的に分かりやすく表示するため、以下のような工夫が可能です：
- デジタル時計形式での時刻表示
- 時刻に関連する追加情報（タイムゾーン、曜日など）
- 設備管理文脈に応じたアクション提案

## 拡張可能性

### 1. 追加の Function Calling 実装案

- **設備状況取得**: `get_equipment_status(equipment_id)`
- **アラート情報取得**: `get_active_alerts(severity_level)`
- **保全スケジュール取得**: `get_maintenance_schedule(date_range)`
- **センサーデータ取得**: `get_sensor_data(sensor_id, time_range)`

### 2. 高度な時刻機能

- **タイムゾーン変換**: 複数の工場拠点に対応
- **営業時間判定**: 営業時間内外の判定機能
- **シフトスケジュール連携**: 現在のシフト担当者情報

### 3. セキュリティ考慮事項

- Function 実行権限の適切な管理
- 機密情報への Function アクセス制御
- 監査ログの記録

## テスト項目

### 1. 機能テスト
- [ ] 時刻取得関数の正常動作
- [ ] タイムゾーン表示の正確性
- [ ] Function Schema の適切な定義

### 2. 統合テスト
- [ ] OpenAI API との正常な連携
- [ ] フロントエンドでの表示確認
- [ ] エラー時のフォールバック動作

### 3. パフォーマンステスト
- [ ] Function Calling のレスポンス時間
- [ ] 複数同時リクエストの処理

## まとめ

Function Calling 機能により、AI チャットが実際のシステム機能と連携して、より実用的な情報提供が可能になりました。現在時刻の取得は基本的な機能ですが、工場設備管理システムにおける様々な場面での活用が期待できます。